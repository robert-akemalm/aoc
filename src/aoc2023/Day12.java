package aoc2023;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class Day12 {
    private static void a(Input input) {
        System.out.println(input.records.stream().mapToLong(s -> new Explorer(s).numSolutions()).sum());
    }

    private static void b(Input input) {
        System.out.println(input.records.stream().map(SpringRecord::unfold).mapToLong(s->new Explorer(s).numSolutions()).sum());
    }

    record SpringRecord(char[] springs, int[] groups) {
        SpringRecord unfold() {
            SpringRecord r = new SpringRecord(new char[springs.length * 5 + 4], new int[groups.length * 5]);
            for (int i = 0; i < 5; i++) {
                if (i > 0) {
                    r.springs[i * springs.length + i - 1] = '?';
                }
                System.arraycopy(springs, 0, r.springs, i * springs.length + i, springs.length);
                System.arraycopy(groups, 0, r.groups, i * groups.length, groups.length);
            }
            return r;
        }
    }

    record Explorer(char[] springs, int[] groups, Map<State, Long> stateToSolutions) {
        record State(int pos, int groupIx, int seenInGroup) {}

        Explorer(SpringRecord record) {
            this(record.springs, record.groups, new HashMap<>());
        }

        long numSolutions() {
            return numSolutions(0, -1, 0, "");
        }

        long numSolutions(int pos, int groupIx, int seenInGroup, String debug) {
            if (pos == springs.length && groupIx == groups.length - 1 && (seenInGroup == 0 || seenInGroup == groups[groupIx])) {
                return 1;
            } else if (pos == springs.length || groupIx >= groups.length) {
                return 0;
            }

            State state = new State(pos, groupIx, seenInGroup);
            Long cached = stateToSolutions.get(state);
            if (cached != null) {
                return cached;
            }

            long solutions = 0;
            if (springs[pos] == '.' || springs[pos] == '?') {
                if (seenInGroup == 0 || seenInGroup == groups[groupIx]) {
                    solutions += numSolutions(pos + 1, groupIx, 0, debug + '.');
                }
            }

            if (springs[pos] == '#' || springs[pos] == '?') {
                int nextGroupIx = seenInGroup == 0 ? groupIx + 1 : groupIx;
                if (nextGroupIx < groups.length && seenInGroup + 1 <= groups[nextGroupIx]) {
                    solutions += numSolutions(pos + 1, nextGroupIx, seenInGroup + 1, debug + '#');
                }
            }

            stateToSolutions.put(state, solutions);
            return solutions;
        }
    }

    record Input(List<SpringRecord> records) {
        static Input parse(String input) {
            return new Input(input.lines()
                                  .map(l -> new SpringRecord(l.substring(0, l.indexOf(' ')).toCharArray(), Util.extractInts(l)))
                                  .toList());
        }
    }

    private static final String TEST_INPUT = "???.### 1,1,3\n"
                                             + ".??..??...?##. 1,1,3\n"
                                             + "?#?#?#?#?#?#?#? 1,3,1,6\n"
                                             + "????.#...#... 4,1,1\n"
                                             + "????.######..#####. 1,6,5\n"
                                             + "?###???????? 3,2,1";

    private static final String INPUT = "##???#??#?????????#? 11,6\n"
                                        + "???.#??#.??? 1,1,2,1\n"
                                        + "#????#?.???????. 3,3,4\n"
                                        + ".#?????####.?.#? 1,1,5,1\n"
                                        + "?#?????????#?#? 3,2,1,1,1\n"
                                        + ".?#??.?..#. 4,1\n"
                                        + "??.??????????.? 1,1,3,1,1\n"
                                        + "?#???..??.?????##??# 1,1,1,3,6\n"
                                        + "#?.?#????#?#.. 2,8\n"
                                        + "..#??????. 3,1\n"
                                        + "?#?????#.??# 7,2\n"
                                        + "??#?????#.?#?##???? 3,4,5,1,1\n"
                                        + "???????#??? 6,1\n"
                                        + "#..?#?##??????.#?#? 1,6,1,3\n"
                                        + "???#..??#? 1,1,2\n"
                                        + "???#?.#?#.??.?? 3,3,1\n"
                                        + "?#???.?..# 2,1,1\n"
                                        + "#??#?????##?.???? 4,3,1\n"
                                        + "#?????????.??#?. 2,4,2,2\n"
                                        + "?#?????#???#??? 2,4,3\n"
                                        + "?.??.??#??? 2,1,2\n"
                                        + "??#???.??##?#.? 4,5\n"
                                        + "?.#?.#???##???.#?# 1,2,2,5,3\n"
                                        + "????????#?#???? 2,1,6\n"
                                        + ".??.?#?..#. 1,3,1\n"
                                        + ".????.??.??#.#. 3,2,1,1\n"
                                        + "??.?#??????##?#??.?? 1,13,2\n"
                                        + "????#??.???#??. 1,2,4,1\n"
                                        + "??#??????###?#.#? 1,1,9,2\n"
                                        + "??#?..##???#???.?#? 1,9,2\n"
                                        + "?#???#??#?# 5,1,1\n"
                                        + "?#??#.????????? 1,2,1,4\n"
                                        + ".?????#??#?#????. 1,10\n"
                                        + "?.???#?#?#? 1,6\n"
                                        + "????#???#????? 2,8\n"
                                        + "#?#???????.?.?? 7,1\n"
                                        + "??.??#????##?#?##.? 3,7\n"
                                        + "?????#?#?.????#?#? 2,4,7\n"
                                        + "?.????#?###?#?? 1,8\n"
                                        + "?.??????#.????#?##.? 7,1,5\n"
                                        + ".???#???.?? 1,3,2\n"
                                        + "?#.?..????? 2,2\n"
                                        + "..?????...?????? 4,3\n"
                                        + "???#.???.??????? 1,1,1,4,1\n"
                                        + "?###???????#?..?? 7,1\n"
                                        + ".???????#???????#?? 1,1,10\n"
                                        + "#??.??##?#??.## 2,6,1,2\n"
                                        + "??#???.??#????#?? 2,8,1\n"
                                        + "?.?#.???#?????? 1,9\n"
                                        + "???#??##?????. 8,1\n"
                                        + "#??#?#?????###?? 1,5,4\n"
                                        + "?..#??????? 1,5\n"
                                        + "###??##?...??#?# 7,5\n"
                                        + "?#?#??#.??## 6,3\n"
                                        + ".????.?.??# 1,1,2\n"
                                        + "???.?.??#??#??? 1,9\n"
                                        + ".????..#??? 1,3\n"
                                        + "??????..?? 1,1,1\n"
                                        + "?.????##??#? 1,8\n"
                                        + "????##???#.. 5,3\n"
                                        + "??#?????#???# 2,1,2,2\n"
                                        + "#??????????#.?##?.?# 6,1,1,1,3,1\n"
                                        + ".?#??##????. 5,1\n"
                                        + "?????.???#??#??##? 4,8,3\n"
                                        + "????#?#??#?? 1,4,4\n"
                                        + "?.?#??#??..????# 1,7,1,3\n"
                                        + "?.?.??#????.?# 1,5,1\n"
                                        + "?#??..?.??????# 3,1,1,1,2\n"
                                        + "?##?#???#??.???? 4,4,3\n"
                                        + "???#?????#?????????? 13,1,1,1\n"
                                        + "????#?.???????#? 3,2,2,5\n"
                                        + "?.#??#.??#?????? 4,4,2,1\n"
                                        + ".?#?#####..?.?.?. 7,1\n"
                                        + "##????.?#????. 4,5\n"
                                        + "????????#????????. 2,1,4,1,2\n"
                                        + "????.??#???..? 1,1,5\n"
                                        + "#????.?..?#? 2,1,2\n"
                                        + "??????#???? 2,1,5\n"
                                        + "??#??.???? 1,3,1\n"
                                        + "?#??#??##?.????#?.? 2,7,5\n"
                                        + "???????.??? 4,1,1\n"
                                        + ".?##????#??? 3,4\n"
                                        + "???.?#.?.??.. 2,2,1,2\n"
                                        + "????.???????. 1,7\n"
                                        + "?#?#.?#????#? 3,1,1,1\n"
                                        + "??#?????##??.#.??? 1,6,1,3\n"
                                        + "?????????.?###?#. 2,1,1,2,6\n"
                                        + "?#.##????#????#.??? 2,2,1,7,1\n"
                                        + "#??#.?????#??. 4,5\n"
                                        + "?#??#..?????#?#??#? 2,1,1,8\n"
                                        + "##?.?.?#?.#?????? 2,1,2,7\n"
                                        + ".???.???....#??# 1,2,2,1\n"
                                        + "??#??#????##?????.? 7,8\n"
                                        + "..?????.?. 1,1\n"
                                        + "???????#?#??????.. 1,7\n"
                                        + "#?????????#??..?? 1,3,1,5,1\n"
                                        + "???.??#??.. 3,2\n"
                                        + "???.#?#????????? 1,1,1,9\n"
                                        + "?.?#??#??.?#. 6,1\n"
                                        + "????#?#????.#??..? 7,1,1,1,1,1\n"
                                        + "???..#?.#???? 1,1,3,1\n"
                                        + "??.??...??? 1,1,1\n"
                                        + ".##??????..#? 4,3,1\n"
                                        + "????.??.???###??. 1,1,1,1,5\n"
                                        + "?..??????.?? 5,1\n"
                                        + "???????#??.?. 3,4,1,1\n"
                                        + "#????##?.??#?.? 1,3,3\n"
                                        + "??.?#?##?#?????????? 2,13\n"
                                        + "????#??#?##??. 1,9\n"
                                        + "????.???#??.. 3,3\n"
                                        + "??#?#??#?? 3,1,1\n"
                                        + "?#?##??.????#???? 4,2,4,1\n"
                                        + ".??#???#???#??????#? 2,13\n"
                                        + "?.?#.?..?#??#??#???? 2,1,8\n"
                                        + "????.?###???#.?. 1,7\n"
                                        + "..#?????????#???? 1,2,5\n"
                                        + "???????.?#..? 6,1\n"
                                        + ".#???###????.? 1,6,1\n"
                                        + "??.??###?????#???.. 6,7\n"
                                        + "#?..#??###???.?? 2,1,7,2\n"
                                        + "???.??#?#??#?##?? 1,12\n"
                                        + "#???????#?????#??#?. 1,1,10,2\n"
                                        + ".????###???.???? 10,3\n"
                                        + "??#?.?.#??? 3,3\n"
                                        + "?##?????.#?? 4,1,2\n"
                                        + "??#??.??.????##? 3,1,4\n"
                                        + "???#####??.? 7,1\n"
                                        + "#?##??#??#.????? 8,1,3\n"
                                        + ".#.??#.????? 1,1,1,1\n"
                                        + "??#??.???.#? 2,1,1\n"
                                        + "???.????????????#??? 1,10,3\n"
                                        + ".?.##????? 1,2,2\n"
                                        + "?.##??#???#???.?#??. 11,4\n"
                                        + "?????#?????##????.#? 13,1,2\n"
                                        + ".???#?.??? 4,2\n"
                                        + "?#?#????#?.. 5,3\n"
                                        + ".???#?????#?#? 3,3,2\n"
                                        + "..??.???#.????.. 4,1,1\n"
                                        + "????????????. 1,2,1,1\n"
                                        + "??????##..?. 1,1,1,2\n"
                                        + "?.????#????.?????? 1,1,3,1,3\n"
                                        + "?#???##??#???#? 8,2,2\n"
                                        + "??...???????#?# 1,2,4\n"
                                        + "??????#????#? 7,2\n"
                                        + "???.#..??.?#?.#???? 2,1,1,3,2,1\n"
                                        + "?#???###?#? 1,5\n"
                                        + "????????????? 1,1,5,2\n"
                                        + ".?.??#?#????????#?? 1,5,8\n"
                                        + ".????#???.#??#?#?#.? 4,8\n"
                                        + "?#?.????.###??? 1,4,3,1\n"
                                        + "?##.???#?????#? 2,11\n"
                                        + "?.??###.?.?##?##?#?? 4,8\n"
                                        + "???##????????? 1,5,1,2\n"
                                        + "##.????#...?#? 2,2,2,2\n"
                                        + ".?#??????.? 1,5\n"
                                        + "..?#?????.#??#. 3,4\n"
                                        + "?.???.????#? 2,1,2\n"
                                        + ".????????????#?#???? 5,11\n"
                                        + ".???#????###????#??? 12,4\n"
                                        + "???#??.???????? 1,1,6\n"
                                        + "#??#.?#??.????# 1,2,4,1,1\n"
                                        + ".?.??.???#?.??#?? 5,4\n"
                                        + "??#?#.????.? 3,1,1\n"
                                        + "????..???##?#????#. 1,1,8,2\n"
                                        + "?#??.????? 2,2,1\n"
                                        + "???#?###.?#???????.# 1,5,9,1\n"
                                        + "#????##?#??##? 1,4,5\n"
                                        + "?#??##.???.??? 5,1,2\n"
                                        + ".???####?????? 7,1,2\n"
                                        + "?##?????.#.?#####??? 4,2,1,7,1\n"
                                        + "???##...??? 3,1\n"
                                        + "????#????#??##???? 10,6\n"
                                        + "???#?????????? 1,10\n"
                                        + "#?????#?#?#??????.?? 9,1,1,1,1,1\n"
                                        + "?????#??#?. 1,4\n"
                                        + "????#??#?? 1,1,5\n"
                                        + "?#?###???????#??#? 1,5,8\n"
                                        + "???#???.??????. 3,5\n"
                                        + "?##...#?#..?. 2,3\n"
                                        + "???#???#.?#??#?###.# 1,5,9,1\n"
                                        + "?.##?#??#??. 1,5,1,1\n"
                                        + "??#?#????????#??#??? 2,1,2,7,1\n"
                                        + "????##??##?????. 10,1\n"
                                        + "?.?????????.???? 4,1\n"
                                        + ".???????.# 2,1,1\n"
                                        + ".??##??##?.?? 5,3\n"
                                        + "??????.?.??.?#?# 3,2,1,1,1\n"
                                        + "#?.?.#??#?#??#????? 2,1,13\n"
                                        + "??.#.??###?? 1,1,1,4\n"
                                        + ".??####???#?## 6,5\n"
                                        + "??.??##????????? 2,2,2,3\n"
                                        + "..?.###?##??????? 7,1\n"
                                        + "??????????.? 2,4,1\n"
                                        + "?.#.?.?.??. 1,2\n"
                                        + "????????#.?..?? 1,5,2\n"
                                        + "??.#??#?#??#? 1,7\n"
                                        + "?...???#??????.? 1,1,6,1,1\n"
                                        + "#????????#???#. 3,1,1,2,3\n"
                                        + "#????#??.??? 3,1,1,1\n"
                                        + "#??#?#.???#?##???.?? 6,5\n"
                                        + "?.?.?#????#????#### 1,1,2,1,3,5\n"
                                        + "????.????????.?? 1,1,7,1\n"
                                        + "?##?.????.???? 3,2\n"
                                        + ".??#.???#???####??. 3,1,9\n"
                                        + "??#.???.##? 1,1,2\n"
                                        + ".??##??????#?.? 1,3,4\n"
                                        + "??.?#?#???#??#? 2,1,1,3,1\n"
                                        + "?#?#??.?.??????.#?? 5,1,5,1,1\n"
                                        + "???.?????##??##?? 1,1,1,7,1\n"
                                        + "..#?.??????#? 1,2,3\n"
                                        + "????#???##???..?#?# 2,10,4\n"
                                        + "#???#?#?.?????.#.. 7,3,1\n"
                                        + ".##???#???. 2,4\n"
                                        + "?.#???????#?##? 3,2,4\n"
                                        + "?#??#????.##????? 5,2,2,2\n"
                                        + ".#?#?#.?#?#?##???? 3,1,7,2\n"
                                        + "????????#????.?#?? 1,2,7,2,1\n"
                                        + ".?#####???..??? 7,1\n"
                                        + "???????#?? 1,1,2\n"
                                        + "??#?.????#? 4,1\n"
                                        + "????.??????#. 1,4,1\n"
                                        + "???????#?? 2,5\n"
                                        + "?????#?.?.??#? 3,1,1,1\n"
                                        + ".?...????#? 1,1,2\n"
                                        + "?#?????.??#. 1,1,1,3\n"
                                        + "??#?#???#??. 4,1\n"
                                        + "?????..???. 2,2,1\n"
                                        + ".??.?.#?.????#??#?# 1,1,10\n"
                                        + ".????#???#?? 5,1,3\n"
                                        + "?#??#??????????. 9,1\n"
                                        + "#??.?????#?#???? 3,2,7\n"
                                        + "?#.?????????#? 1,1,4,1\n"
                                        + ".????#??#?.#. 5,1\n"
                                        + "???????##??.# 1,1,5,1\n"
                                        + "?##?#??.??#????#?? 6,3,4\n"
                                        + "?##???????##? 3,1,1,4\n"
                                        + "#??????#.?? 8,1\n"
                                        + "#????#??????#??# 1,1,1,5,1\n"
                                        + "?.??.#????#????. 1,1,1,7\n"
                                        + "..?##??###?#???????. 9,4\n"
                                        + "??.??#?.??##???? 1,3,8\n"
                                        + "???##..?.?? 2,2\n"
                                        + ".?#???#??######?? 1,3,7\n"
                                        + ".????.#?#?#??. 1,6\n"
                                        + "??##???#???#?????# 4,3,2,1,2\n"
                                        + "??.?????????? 2,1\n"
                                        + "????#????????.#??? 4,1,2,1,2\n"
                                        + "?#?#???.?..?????.? 4,2,1\n"
                                        + ".#???#.??.?#?##??? 1,3,1,6\n"
                                        + "??????#??# 3,2,1\n"
                                        + "?.#.??.??#?#?##? 1,1,1,1,7\n"
                                        + "?##????##??.? 4,5\n"
                                        + "???.?#?.?? 1,1,1\n"
                                        + "????#.??#?.??#?#.? 1,3,1,3,1\n"
                                        + "?????#?#?.?????#? 1,2,1,1,3\n"
                                        + "???.??????? 2,2,2\n"
                                        + "?#?#??.?#?#?? 5,5\n"
                                        + "??????????##?#? 1,1,7,1\n"
                                        + "?????#.??????? 2,3,2,2\n"
                                        + "?#????#?#? 1,5\n"
                                        + "?.?#????..??#?... 5,4\n"
                                        + "..#???#??? 1,1,3\n"
                                        + ".#?#.?#?##??????? 1,1,4,1,2\n"
                                        + "?##?.#?#???# 3,3,1\n"
                                        + "?????#???? 2,5\n"
                                        + "???#???##. 1,1,3\n"
                                        + "??##???.#.??? 6,1,1,1\n"
                                        + "????.??..? 4,1,1\n"
                                        + "????.???#? 2,1,4\n"
                                        + "?#??.???.??#????? 2,2,8\n"
                                        + "????????##??#? 1,1,5\n"
                                        + "?????#???. 1,1,1\n"
                                        + "##.???.##. 2,2\n"
                                        + "?#?.???#?????.? 2,4,1\n"
                                        + "?????..?.??##???? 5,1,3,1\n"
                                        + "#?#?..?????#???? 1,1,6,2\n"
                                        + "..#????#???##?.?..#? 1,1,8,1,1\n"
                                        + "?.?..?#??#??#??. 2,6\n"
                                        + ".???###?#??? 1,5,1\n"
                                        + "???.?#??#??##? 1,9\n"
                                        + "???#?????##??.??#. 12,3\n"
                                        + "##???????#?#? 3,3,3\n"
                                        + "???..?#?##? 3,5\n"
                                        + "??..??.???#??.. 2,4\n"
                                        + "???.????..???#.????. 1,3\n"
                                        + "???##...?.???? 3,1\n"
                                        + "??????#?.?#.??? 2,4,1,1\n"
                                        + "???????#.#?. 1,1,2,1\n"
                                        + "?????##????? 1,4,1\n"
                                        + "?####.?????#? 4,2,3\n"
                                        + "?#.#????#..? 1,1,3\n"
                                        + "..??#??.?#?#????? 4,6\n"
                                        + "?###????#???####?.?. 9,5,1\n"
                                        + "?###??#???.?.?? 10,1\n"
                                        + "?.???#?#??#?????? 1,1,2,4,1\n"
                                        + ".???.?????? 1,3,1\n"
                                        + "??????#????##?.#?.?. 10,3,2,1\n"
                                        + ".??.?.?##???#???# 1,1,6,3\n"
                                        + "??#??????#.#?.##?#?? 9,1,4\n"
                                        + "????.?#?#???#????.#? 3,1,2,1,3,1\n"
                                        + "?????##?????.?# 1,1,7,2\n"
                                        + "??????.#?????#? 1,1,1,4,1\n"
                                        + ".?#??????#.?.. 1,4\n"
                                        + "??????.#??. 4,1,1\n"
                                        + "?????????#?#?? 2,6\n"
                                        + "?.#???????#?????#??? 10,1,2\n"
                                        + "???????#??. 1,2\n"
                                        + "?##???????.#???# 6,2,1,1,1\n"
                                        + ".???#?##?#?????.??? 2,6,1,1,1,1\n"
                                        + ".??????#??? 2,3\n"
                                        + "#???????#??.?##? 1,8,4\n"
                                        + ".#.??##??.?? 1,3,1,1\n"
                                        + "???..#??..?? 3,1,1,2\n"
                                        + "?????????#????#??? 2,12\n"
                                        + "?????.###..##?? 4,3,4\n"
                                        + "???.?????#??#??#??## 1,16\n"
                                        + "?????#??###? 2,1,5\n"
                                        + "##????????#??.?? 12,1\n"
                                        + "?.??.#?#?????#?###?? 1,5,5,1\n"
                                        + ".???.???#?#????####? 2,1,9\n"
                                        + "..???#??????#??. 2,7\n"
                                        + "??.#?#??#??.?.#?#.? 2,8,3,1\n"
                                        + "??.???#???## 1,6,2\n"
                                        + ".????.??#??.#??#. 4,4\n"
                                        + "???.???##?? 2,1,2\n"
                                        + "??.???#?#??.#?????#? 1,5,8\n"
                                        + "????.??#?..????? 3,1\n"
                                        + "???##????? 1,5\n"
                                        + "???#??.??????#??. 5,7\n"
                                        + "??#??..??? 3,1\n"
                                        + "???.??#???????#??#? 2,1,3,5,1\n"
                                        + "???#??????#???.#?? 11,2\n"
                                        + "??.#?#?#???.#???#?? 1,3,3,3,1,1\n"
                                        + "?#..??.???#??. 1,5\n"
                                        + "?.?#..?#?#???#? 2,8\n"
                                        + "#?????#.????? 2,3,1\n"
                                        + "#?#??#???##????.? 14,1\n"
                                        + "??????.??????#? 2,1,1,1,2\n"
                                        + "??#???????.??? 8,1\n"
                                        + "??.???.#??##.???##?? 1,2,1,3,1,5\n"
                                        + "??.????#.#.?# 1,4,1,1\n"
                                        + "?.???.??##.. 1,1,1,2\n"
                                        + "#????????????? 3,1,4,1\n"
                                        + "??????#?#. 1,6\n"
                                        + "??#?#..??#????? 3,1,6\n"
                                        + "???#???????#??????? 1,1,1,1,5,1\n"
                                        + "??#??#?#?###..???? 11,1,1\n"
                                        + "???#?##?##?. 2,1,2,3\n"
                                        + "??.??#?????????##??? 1,1,1,1,1,6\n"
                                        + "??#????##?#.? 2,5\n"
                                        + ".?????#.????. 2,1,1,1\n"
                                        + ".?.?.##?????####?? 1,11\n"
                                        + "?.#?#?#.?# 3,1,1\n"
                                        + "#??#?#?????.#? 1,8,1\n"
                                        + "?????#.?#?#?##??.? 1,1,1,9\n"
                                        + "?????????#???? 3,2,1,4\n"
                                        + "?#?#.?.?.. 4,1,1\n"
                                        + ".#.?##?????? 1,3,1\n"
                                        + ".?#?#?#?????.? 7,1,1\n"
                                        + "??????..??..?#????. 3,5\n"
                                        + "#???.?.?????# 1,1,1,6\n"
                                        + "???????#??##??????# 1,2,12\n"
                                        + "??#???#??..?.???#? 2,4,1,1,1\n"
                                        + "#?#?????##??##?#??# 1,14,1\n"
                                        + "..?#???#??#?? 6,1\n"
                                        + ".???????????. 1,3,1\n"
                                        + "????????#??.#?.?? 8,2\n"
                                        + "??.??..?.#.??#?.? 1,1,1,1,4\n"
                                        + ".?#???##????. 3,4,2\n"
                                        + "?????#????.? 5,1\n"
                                        + "?#??#.????#??##.? 5,1,4,2\n"
                                        + "??.#???#?#.??.??? 1,7,1,2\n"
                                        + "?.????#?##????? 1,1,6,1,1\n"
                                        + ".????##?#..?.?? 2,4\n"
                                        + "?#??????#.??.?????? 2,4,1,1,1,1\n"
                                        + "??#??#?#??.?#?#.. 7,4\n"
                                        + "??.?#???.. 1,1,1\n"
                                        + "???##?#?????##?##??# 10,8\n"
                                        + "?#.##???##.??#? 1,3,2,1\n"
                                        + "?##?#.???? 2,1,3\n"
                                        + ".???##??#??? 1,8\n"
                                        + "????#??.?????. 1,4,3\n"
                                        + ".???.????.#? 1,1,1,2\n"
                                        + "??##?#????#????#.#.# 1,10,1,1,1\n"
                                        + "?????#?.????#??? 3,4\n"
                                        + "?#??#??#????#?? 3,4,3\n"
                                        + "??.??#..?? 1,1,1\n"
                                        + "?#??#??#????.? 1,8,1\n"
                                        + "?#??#???????## 1,4,3\n"
                                        + "??#.???????.?.#???# 1,1,2,3,1,5\n"
                                        + "???.???#?.??????#?#. 3,3,1,1,3\n"
                                        + "#??#??##?#???#??# 1,1,7,1,2\n"
                                        + "#?##.????.?? 4,2,1\n"
                                        + "?##???.?#????#? 5,8\n"
                                        + ".???#?##????. 1,8\n"
                                        + "????????.? 3,1\n"
                                        + "??.??..????.????? 2,1,2,1,2\n"
                                        + "???#?????#..?. 4,1,1,1\n"
                                        + "?.?##?#??#??#?? 5,6\n"
                                        + "???????##???#??? 2,10\n"
                                        + "#.??.#?..????? 1,2,3\n"
                                        + "??##.#??.? 2,1,1\n"
                                        + "?.#?#?#?.?#??#????#? 6,6,3\n"
                                        + "?.?????????#??#?# 1,10\n"
                                        + "?????????#? 1,5,2\n"
                                        + "??#?..?##??#? 3,5\n"
                                        + "??#?#???????.#.?..## 6,1,1,1,2\n"
                                        + ".?????#?#. 1,2,1\n"
                                        + ".?#.#.?????#? 1,1,1,5\n"
                                        + "#??#?.?..###?????? 4,1,9\n"
                                        + ".#?.?#?????#? 1,2,1,1\n"
                                        + "?##????.???????.# 6,3,1\n"
                                        + "#.?????#????#.? 1,1,1,6,1\n"
                                        + "?..??#.???.#??.. 2,1\n"
                                        + "????#?.##????? 3,3\n"
                                        + "??#??#?.?????? 5,1\n"
                                        + ".#.##.???.?#???#?.?# 1,2,1,1,6,2\n"
                                        + "???#?##?.??????????# 7,9\n"
                                        + "???.?#???? 3,5\n"
                                        + "??.?#?.???.???? 2,3,1,2,1\n"
                                        + "?##??#?#??#????.? 8,5\n"
                                        + "#..#?#??.?.???##?? 1,3,1,1,1,5\n"
                                        + "?????????#?#?#? 3,1,1,3,2\n"
                                        + ".????.?.?#?.???##?. 2,3,3\n"
                                        + "??#?#?.?????..??#?.. 4,1,2,4\n"
                                        + "..?#?#???.????.??#. 6,1,1,1\n"
                                        + "?##???????.? 9,1\n"
                                        + "#?.????.#??##????? 1,2,1,7,2\n"
                                        + ".#.?#?.?.?#.. 1,2,1,1\n"
                                        + "??.?????.?? 1,2,1\n"
                                        + ".#??????.?# 1,4,1\n"
                                        + ".???????????#??.. 5,1,2,1\n"
                                        + "?..#????.??? 4,1\n"
                                        + ".#?#?????? 1,7\n"
                                        + ".????????##?? 2,2\n"
                                        + "?#????##????.? 7,1\n"
                                        + "..?#??..??#?...?#. 2,3,2\n"
                                        + "?#??#.#???.??.?#? 1,2,2,1,2\n"
                                        + "??#??###.? 2,3\n"
                                        + "???#??#???. 1,1,4\n"
                                        + "??#?##?.?.???????#?. 5,1,1,5\n"
                                        + "???????????..?? 2,1,1,1,1\n"
                                        + "????.?#????##??#??? 1,2,4,2,2\n"
                                        + "???#???#?#?.???# 1,1,6,1,2\n"
                                        + "???.??..?????? 2,1,4\n"
                                        + ".?????##????????? 1,7,3,1\n"
                                        + "?#??.????#?#?#???? 3,7\n"
                                        + "?.?#??#?#??????.??? 11,1\n"
                                        + "?.?#.??#???# 1,1,7\n"
                                        + "?#?????#??.. 2,3\n"
                                        + ".?????#???????? 2,5,4\n"
                                        + "??.?##??.#?? 1,3,2\n"
                                        + "???##????#.?? 1,3,1,2\n"
                                        + "#?##?.?.?????????? 1,2,3,1\n"
                                        + ".??.????.? 2,4,1\n"
                                        + "#.?.??.???#? 1,1,1,1\n"
                                        + "?.#????#????.?? 6,2\n"
                                        + "??##.????### 3,5\n"
                                        + "?.?????#???.#.???? 1,7,1,1,1,1\n"
                                        + ".?????????#???#?? 6,5\n"
                                        + ".?.??#???.???? 1,1,2\n"
                                        + ".??.????#????.?#??? 2,8,2,1\n"
                                        + "??..???..?#.# 1,2,1,1\n"
                                        + ".??#???#??? 3,3\n"
                                        + "???##?????????.? 2,5,1,2,1\n"
                                        + "???.?##?#?#????#?.?? 1,2,1,7,1\n"
                                        + ".??.?#.?#??????..??? 1,2,2,5,1\n"
                                        + "????#????. 2,1,1\n"
                                        + "?#???#?.?#?.???# 2,2,3,4\n"
                                        + "??????.????... 4,2\n"
                                        + ".??#?????#???? 8,1\n"
                                        + "#??????#???? 2,2,5\n"
                                        + "?#???????.??###?..#? 3,1,1,1,4,1\n"
                                        + "?#??#?..??.??.? 1,2,1,2,1\n"
                                        + "#????????????# 1,2,1,6\n"
                                        + "?#?.?????.???##??. 1,1,1,1,6\n"
                                        + "????#??.???? 4,2\n"
                                        + "????????#???.#?# 4,1,1,2,3\n"
                                        + "?##??????.????.?.??? 6,1,3,1,1,1\n"
                                        + "??#?#??#??? 5,1,1\n"
                                        + "??##???##???#? 2,6\n"
                                        + ".?#?#?...?#? 1,2,3\n"
                                        + "??????#????###??? 5,7\n"
                                        + "?..????.????.?#. 3,3,2\n"
                                        + "???????#?? 6,1\n"
                                        + "???.????#?. 3,1,3\n"
                                        + "#?..???.?##? 1,1,1,4\n"
                                        + "??#????????? 2,1,1,1\n"
                                        + "????##????#??? 4,5\n"
                                        + ".??#?#.??.?????????? 5,3\n"
                                        + "...#????#???? 2,2\n"
                                        + "#??#???#..??? 1,6,1,1\n"
                                        + "?#??????#????.?#.??? 1,3,3,1,1,3\n"
                                        + "????#?#?#?#??..#?.? 10,2\n"
                                        + "#?????.?.??#?#??# 1,2,1,1,6\n"
                                        + "????#????????????? 3,1,1,2,1,4\n"
                                        + "#.?????#????? 1,1,2,2\n"
                                        + "?.##?????????? 1,2,2,5\n"
                                        + ".?#???##???. 6,2\n"
                                        + ".#??#??????.???## 1,7,1,2\n"
                                        + ".??.?????#??.?. 1,2,5,1\n"
                                        + "??#??###??#.??? 2,5,1,1\n"
                                        + "#?.#.#??????#. 1,1,8\n"
                                        + "???????##??#?? 2,7\n"
                                        + "???#???##?..?? 4,2,2\n"
                                        + "?##??#??#??..????. 11,1\n"
                                        + "???##??????#?? 1,4,1,2\n"
                                        + ".??.???##??#??.??.? 1,1,7,1\n"
                                        + "#?#?#?##???.???.??.? 11,1,1\n"
                                        + "???..?###?#??#??...# 3,11,1\n"
                                        + "?.???.????#??? 1,1,5,1\n"
                                        + "#??.?####????#???? 3,11\n"
                                        + "#??.???????? 1,3,1\n"
                                        + "?#?#?#?.?.#???? 6,5\n"
                                        + "..?#?###..#.? 6,1\n"
                                        + "??#.???.?#? 2,3,3\n"
                                        + "??#??????#????? 4,5,3\n"
                                        + "??.?????##???????? 1,14\n"
                                        + ".?.??#?..??#.? 1,3,2\n"
                                        + "??????.????.#. 5,3,1\n"
                                        + ".???????.??#??????? 1,1,1,10\n"
                                        + "???..??.?#??.#?? 1,2,2,1\n"
                                        + "??#???#????#? 1,6,3\n"
                                        + "???#.#???.?#?#?#?## 3,1,2,9\n"
                                        + "?##??.?#??.???..# 3,3,2,1\n"
                                        + "????#???????#?##?# 1,1,1,2,6,1\n"
                                        + "#.??#??????? 1,4,1,1\n"
                                        + "##??#??#?.###?#??#?? 8,8\n"
                                        + "?##?????????????? 7,3\n"
                                        + "##??????#####? 5,5\n"
                                        + "#???#??..#?#?.? 2,1,1,1,2\n"
                                        + ".?????..????#?? 2,1,3\n"
                                        + ".?#???##??#??. 7,2\n"
                                        + "???#?##?.? 1,4,1\n"
                                        + ".?.#.?????#?????#? 1,1,3,2,2\n"
                                        + ".##??????#??????# 4,1,2,1,3\n"
                                        + "??.?.??##?????? 1,10\n"
                                        + ".#?#.?#?.??#?#??.?? 3,3,3,1,1\n"
                                        + "??##?.???####. 5,6\n"
                                        + ".??##?.#?#?#.?? 3,5\n"
                                        + "?.?.?#??????#???#??? 3,7\n"
                                        + "??????#????... 1,1,1,1\n"
                                        + "?#.?#?????????.?? 1,2,1,5,1\n"
                                        + "????###??.#??##.??? 1,5,5,3\n"
                                        + ".?????.#?????.????? 1,1,5,4\n"
                                        + ".??..??#?.?? 1,4,1\n"
                                        + "?#?.?#??##?#?#.? 1,2,6\n"
                                        + ".#..???.?.#? 1,1,1,1\n"
                                        + "?##?????????#???#??? 4,5,2,4\n"
                                        + "??#??#?????#?#. 1,1,4,1,1\n"
                                        + "#?.?#???###??#??.# 2,2,8,1\n"
                                        + "#??.??##.?????.?# 3,4,5,1\n"
                                        + "?..#????#????????? 1,1,4,2,3\n"
                                        + ".#?????????#.?.?? 3,4,2,1,1\n"
                                        + "?#?#??#?.#???# 4,1,1,3\n"
                                        + ".??????????.# 3,6,1\n"
                                        + "???????????? 8,1\n"
                                        + "??????#??.??#??? 5,1,4\n"
                                        + "?????.#??.?. 2,1,3,1\n"
                                        + "#???##??????????#?? 1,3,1,5,2\n"
                                        + "??#.??#???? 2,1,5\n"
                                        + "????##????????.#???? 9,1\n"
                                        + "?????..????#? 2,5\n"
                                        + "?#?#?.?.??#?##? 1,2,1,7\n"
                                        + ".#?????????? 1,1,1,1\n"
                                        + "?#???.?#..? 4,2\n"
                                        + ".#?.#??.????..???? 2,1,1,1,1,2\n"
                                        + ".?##??#.???#???.?#? 3,2,4,1,1\n"
                                        + "?.?#?#???#? 4,1\n"
                                        + "..?..??#??#???? 1,6,2\n"
                                        + ".??#????#?#. 3,4\n"
                                        + "??#?#.#.???????.??## 5,1,1,4,4\n"
                                        + "??.???????# 1,1,1\n"
                                        + "..???#?#.??.?#.?#.# 6,1,1,1,1\n"
                                        + "?????##??#??.? 1,3,2\n"
                                        + "?##??#?#?##?????? 11,3\n"
                                        + "#?#???#?????.????? 1,1,4,1,1,1\n"
                                        + "?????..??????????#? 2,2,1,1,8\n"
                                        + "?????###???##??? 9,4\n"
                                        + "?????#??##???.? 1,1,1,5,1\n"
                                        + "##?.?????##?#?##. 2,1,9\n"
                                        + "???#?..??#????#?#?. 3,8\n"
                                        + "???#?#???#.? 6,1\n"
                                        + "?..??#??.. 1,3\n"
                                        + "??????#?##.#??? 1,1,4,1,1\n"
                                        + "???????#????.????## 6,1,1,2\n"
                                        + "???.??..#.?.??????.? 1,1,1,1,6,1\n"
                                        + "?.???..?#??.??###. 1,1,1,2,1,3\n"
                                        + "?.##???????#?. 6,1,1\n"
                                        + "?????..#.?#????#? 4,1,3,3\n"
                                        + "?.??##??##??????? 12,1\n"
                                        + "????.?#?##???. 1,1,8\n"
                                        + "??###????#??.?#?.?? 7,1,1,2\n"
                                        + "###???##????? 3,4\n"
                                        + ".?.??##?#?#???????? 1,1,4,9\n"
                                        + "#.????###?.#. 1,7,1\n"
                                        + ".?#??.?????? 1,1,2,1\n"
                                        + "?#..?????? 1,4\n"
                                        + "?#??.????#?.?.??? 2,2,2,1\n"
                                        + ".#???#?..?? 2,1,1\n"
                                        + ".??????#.?##?.?.#??? 4,2,2,3\n"
                                        + "???###?#???????.?# 1,6,6,1\n"
                                        + ".??????#..#??.#??. 1,5,3,1\n"
                                        + "???.?????? 2,1\n"
                                        + "????????#?#.?????##? 2,1,3,1,4\n"
                                        + "?.?#?#?#?????.???.?? 8,1\n"
                                        + "##.??#?#???##??????? 2,5,3,1,2\n"
                                        + "??#?#??#???.???? 7,4\n"
                                        + "??.??###????#?.? 1,1,8\n"
                                        + "????#???.???#?#???? 8,1,3,1,1\n"
                                        + ".????.??.???##?# 1,1,2,1,4\n"
                                        + "????##??????? 1,5,1,2\n"
                                        + ".?#..?##?#? 1,5\n"
                                        + "??????#???#???#?? 2,9\n"
                                        + "?#?#???#???.?????? 1,3,4,1,1,2\n"
                                        + "..???#?..?.? 5,1\n"
                                        + "?##??.???##?????? 4,3,2,1\n"
                                        + "???#??#?##?.? 9,1\n"
                                        + ".???##?#???????#? 5,9\n"
                                        + "?#.?#?#?????????.?.? 2,4,3,2,1\n"
                                        + ".#.??????# 1,4,2\n"
                                        + "#???????###????? 6,4,1,1\n"
                                        + "???#?#?..? 4,1\n"
                                        + "??.?##.????.#?? 1,2,1,1,1\n"
                                        + ".????#??????#?? 1,4,4\n"
                                        + "????.?????????.? 2,7\n"
                                        + "#??.##????##??##???? 2,2,1,3,5,1\n"
                                        + "??#??##..???.#??##?? 2,2,1,1,6\n"
                                        + "????.??.#.?# 3,1,1,2\n"
                                        + "?#.?.?#?.? 1,1,1\n"
                                        + ".?.???#?.?????..?.?? 3,4,1\n"
                                        + "..##???.???.#? 5,2,1\n"
                                        + "?.?#???#?#. 2,1,3\n"
                                        + "#????#????????.# 1,1,1,7,1\n"
                                        + "??.???##?.?.? 1,1,2,1\n"
                                        + "?????#????#???.?#? 1,2,2,3,1\n"
                                        + "??.??#?????? 1,3,1\n"
                                        + "?.??#??#?.?##?# 1,3,2,3,1\n"
                                        + "?#??.??.??.? 2,1,1,1\n"
                                        + "#???#???..#?? 5,1,1\n"
                                        + ".#??????????.? 4,3,1,1\n"
                                        + ".??.?#???.??#???#?#? 1,4,4,5\n"
                                        + "???#??????????? 6,1,1\n"
                                        + "?????#??????#??. 1,1,5,2,1\n"
                                        + "?##?..??????. 3,1,2\n"
                                        + "???..?.?##.? 1,1,2,1\n"
                                        + "?????????#? 4,1,2\n"
                                        + ".????.#???#?? 1,1,2,2\n"
                                        + "..??##??????.?#?.?. 6,2\n"
                                        + "?.?.?###?.??.#?.. 1,4,2\n"
                                        + ".##???.????????? 5,3,1\n"
                                        + "..????..?? 4,1\n"
                                        + "??#?...#?#????? 3,1,1,1,1\n"
                                        + "????????????????? 3,11\n"
                                        + ".?.??.?#??#.?????. 1,2,2,1,3,1\n"
                                        + "#...?.##?##??.#.#? 1,1,6,1,1\n"
                                        + "?????????#??##?? 1,3,2,3\n"
                                        + "#??#?##???? 7,1\n"
                                        + ".??.??????.???#? 2,2,1,1,1\n"
                                        + "?#.#..??.?????#? 1,1,1,1,3\n"
                                        + "#????#?.#????#.?#?? 7,6,2\n"
                                        + "????.?#?.?? 1,2,1\n"
                                        + "???###..???#?.#? 1,3,4,1\n"
                                        + ".???#?.????? 3,1\n"
                                        + "???????#?### 3,1,1,3\n"
                                        + "????.????.#? 1,3,1\n"
                                        + "??????????.????#??? 1,2,1,2,1,1\n"
                                        + "????#.??###?#?###?# 1,2,13\n"
                                        + "##?.???#??? 2,4,1\n"
                                        + "?#..#???#?#??? 1,1,6\n"
                                        + "#?..??.??????????#?# 2,1,1,1,7,1\n"
                                        + "?????.?#.????. 2,2,3\n"
                                        + "?????.#.???#? 2,1,3\n"
                                        + "??????#??.??? 1,1,3,3\n"
                                        + "#??#??.?##??#??#?. 1,2,1,6,1\n"
                                        + "#?##?.#???????#?.? 1,3,3,2,2,1\n"
                                        + "???.?????###?#???? 1,4,8\n"
                                        + ".?#????#???????? 4,3,1,1,1\n"
                                        + "??.?????????????##? 1,5,1,8\n"
                                        + "???.?#?????#?# 2,4,3\n"
                                        + "??.????#.#?? 2,2,1,3\n"
                                        + "??????.??????.#?#? 5,2,3\n"
                                        + "??????????? 1,2,3\n"
                                        + "?.?#??#???#?????## 4,8\n"
                                        + "..##?.???#?.#??### 3,5,6\n"
                                        + "????#??.#??.#??? 6,1,1,1,2\n"
                                        + "?.????#???? 1,6\n"
                                        + "????#???????#?#? 1,1,1,7\n"
                                        + "????????.?.#?. 1,1\n"
                                        + ".????##????.??.?? 1,6,2,1\n"
                                        + "?##?.?#?#?.? 2,5\n"
                                        + "??#?#????#?..#?#? 1,1,1,5,4\n"
                                        + "###???.???.???#?? 4,4\n"
                                        + ".??????.?##????? 2,1,3,2\n"
                                        + "?.?????.?# 1,1,1\n"
                                        + "#.##???????? 1,3,1,1\n"
                                        + "#????#.?.#??????? 1,2,1,5\n"
                                        + ".??.?##??.?.?? 4,1\n"
                                        + "##?#.?.?###???#?#?? 2,1,1,10\n"
                                        + "????#?.???#?.?. 1,2,1,2\n"
                                        + "?????????????? 3,1,2\n"
                                        + "?.#??.##?##?..#? 3,6,2\n"
                                        + "?#.??#???#? 1,1,2\n"
                                        + "#???????#??? 1,1,3,3\n"
                                        + "??##??.#?#.???. 3,3,1\n"
                                        + "#.??##???#?#???.#? 1,13,1\n"
                                        + "?????#.??.#?? 1,1,2,1\n"
                                        + "??#?##????????? 1,1,4,1,3\n"
                                        + "?.???.????.?#? 1,1,3,2\n"
                                        + "..????.?#?????.? 1,1,6,1\n"
                                        + "?.?.??#?###?#. 1,1,1,7\n"
                                        + "#?#.?????#????.#. 1,1,7,1,1\n"
                                        + "???.??##????#?#? 3,3,1,3\n"
                                        + "?.??????#??#????.#? 10,1,1,1\n"
                                        + "??????????#???# 1,2,2,5\n"
                                        + "?###?.#?????#?. 4,3,3\n"
                                        + ".##???.???. 3,2\n"
                                        + "#?#.?.????? 3,1,1\n"
                                        + "????#???.#??? 5,1\n"
                                        + ".?#?????#?????.??? 1,1,6,2\n"
                                        + "#?#??##????????.?? 10,1\n"
                                        + "???.?#???#? 1,2,1\n"
                                        + "??#?.????????? 4,4,3\n"
                                        + "??#?#?.##.?# 3,2,2\n"
                                        + "?#?????.#???#.#? 1,3,1,2,1\n"
                                        + "?????#??##..?#? 5,3\n"
                                        + "???#.?#??? 4,4\n"
                                        + "...??.????#????.? 1,7\n"
                                        + "??????.?????#?????#? 2,3,6,2\n"
                                        + "??#??.#??##??#.? 1,1,3,1,1\n"
                                        + ".?????.??#.????? 5,1,1,2,1\n"
                                        + "#?#????##???.#????. 4,3,1,1\n"
                                        + "#.#???.#????#?##?# 1,1,1,2,1,6\n"
                                        + "#?????##????#?##?.?? 10,4,1\n"
                                        + "?#????#?#.??.##???.. 3,5,4\n"
                                        + "?.????.?##??#...? 1,2,2\n"
                                        + "?.???#??#?.?#??? 6,2,1\n"
                                        + "??.?????????##?? 1,2,6\n"
                                        + "?.?#???.#?#?? 2,2,3,1\n"
                                        + "???..?#?#?????#?### 1,1,3,7\n"
                                        + "?#??.?.????#????? 2,6,1\n"
                                        + "????#?????? 2,2\n"
                                        + "??.??#??????.?.??? 1,9,1,2\n"
                                        + "?#???#??.?##????? 1,3,1,8\n"
                                        + "??##?????#?..#???#.? 8,5,1\n"
                                        + "?.???#?#???#????? 1,1,5,4,1\n"
                                        + ".##??#??????????? 3,1,7\n"
                                        + "??###?##???????.?.# 10,1,1\n"
                                        + "#?#????##?????#? 12,2\n"
                                        + "?#??#?.?#??.. 5,4\n"
                                        + "?#?#??????#??.???.# 1,1,4,1,1,1\n"
                                        + "?????????###.#??#??? 2,1,6,1,1,1\n"
                                        + "???#????.?#.??? 2,2,2,1\n"
                                        + ".??????.?????.. 4,5\n"
                                        + "???####???.????.?.?. 7,1,3,1\n"
                                        + ".##??#?.???. 2,2,3\n"
                                        + "?#.?????????? 1,1,3,1\n"
                                        + ".#?.????#??????#?? 1,5,2,1,1\n"
                                        + "#???..?####?..# 4,5,1\n"
                                        + "..???.???.?#.?.. 1,1\n"
                                        + "???.#??###? 1,6\n"
                                        + "..??.?????? 1,2\n"
                                        + "??###??#????. 1,6,1\n"
                                        + "#????#???.???? 2,6,3\n"
                                        + "??#???.??????#?.#? 6,2,3,1\n"
                                        + ".??#??????? 1,3,1\n"
                                        + "?.?.??##???? 1,2,1,1\n"
                                        + "...?.??#?#. 1,4\n"
                                        + "?????#??#???????? 3,2,5,1\n"
                                        + "??.?????.?????? 1,2,1,2,1\n"
                                        + "???.?.??.?#. 1,1,1,1\n"
                                        + ".?##?#???..#???.. 5,4\n"
                                        + "??####??.????. 7,4\n"
                                        + "#????#????#???? 9,1,1\n"
                                        + "?.?.???.?????.???? 1,1,2,4,3\n"
                                        + "??#?#?..??????? 6,1,3\n"
                                        + "..?.#?#?##????#. 9,1\n"
                                        + "?.?..?#?#.? 1,2,1\n"
                                        + "????##?.??# 2,3,2\n"
                                        + "?..??????##?#? 4,4\n"
                                        + "??????????????# 1,8,1\n"
                                        + "????#???#?????.?.?? 1,2,1,4,1,2\n"
                                        + "?.###?#??.??#?#?. 7,4\n"
                                        + "?.#??#?.???#???#?? 4,8\n"
                                        + "??????##????#?..?# 1,9,1\n"
                                        + ".?.???#????????#??? 1,2,5,2,1\n"
                                        + "?#.???#???. 1,5\n"
                                        + "?????#?#???#???##? 3,3,2,3\n"
                                        + "..??????.?#? 4,1\n"
                                        + "#.?????#??????#???#? 1,15\n"
                                        + "?##??#??#???????#.?? 3,5,1,1,2,1\n"
                                        + "??????..#?? 2,1\n"
                                        + "????#.??????.#.?. 3,1,1,2,1\n"
                                        + ".???.????? 1,2\n"
                                        + "????.????. 1,2\n"
                                        + "#????.#.??#??.??? 1,3,1,5,1\n"
                                        + "#.??##???.?.?#????? 1,6,1,2,1,2\n"
                                        + "??.?#.????.#???.#??? 1,1,2,1,1,4\n"
                                        + "?.#?#..?#?. 1,1,2\n"
                                        + "??#?????.?#.?.?.?.. 7,1,1,1,1\n"
                                        + "?#?.????.??.???#.? 2,3,1,1,1,1\n"
                                        + "???#???#.??#??#.? 3,3,1,1,1\n"
                                        + "#????????###???#? 2,1,6,3\n"
                                        + "??.#????#? 1,3,2\n"
                                        + "???#??.#??##?# 5,2,2,1\n"
                                        + "?#??????????#?? 2,5,4\n"
                                        + "#.?#??????#?#??#?##? 1,1,14\n"
                                        + ".??????????#????? 5,1,4,1,1\n"
                                        + "???..?#???#??????##? 1,1,15\n"
                                        + "#??.?#.#??????##. 1,1,1,1,4\n"
                                        + "?????.???.?.?..#.??. 1,1\n"
                                        + "???...#?.????? 1,2,1,3\n"
                                        + ".????#??.?#??## 1,3,2,2\n"
                                        + "?##?.#?..???? 2,2,1,1\n"
                                        + "????.?.?.??? 2,1,1\n"
                                        + "?????..???.?#???? 1,2,4\n"
                                        + "???##.???#??? 5,3,2\n"
                                        + ".????.???.?????? 4,2,1\n"
                                        + "?..???#?????##?# 1,1,1,7\n"
                                        + "###?#???#?.?#????#. 9,2,2\n"
                                        + "???.?????. 1,1,1\n"
                                        + "#?.?.#??#?#??# 1,9\n"
                                        + ".?#???.?.?????? 3,5\n"
                                        + "?.??#?..#?##???#?##? 1,2,12\n"
                                        + "#.??#?#???#?#???? 1,12\n"
                                        + "???.?.???##?? 1,1,4\n"
                                        + "?.?#??#??##??# 1,2,6,1\n"
                                        + ".????????..?????? 6,4\n"
                                        + "???#???????. 3,2\n"
                                        + "?.?????.???????? 2,3\n"
                                        + ".??#.??#????#??. 1,1,5,1,1\n"
                                        + "??.??#?###??????.?#? 1,8,4,3\n"
                                        + "#???.?##?#?.?....?? 1,2,5,1,1\n"
                                        + "?#???#?#?? 2,2,2\n"
                                        + ".???##?.#?#???# 4,1,5\n"
                                        + "?#?#..???? 1,1,4\n"
                                        + "????????.#????#.? 3,1,1,6,1\n"
                                        + "..?.????#??#??????? 1,1,6,1,3\n"
                                        + "?.????###?#?. 1,6\n"
                                        + "???..??#?. 1,3\n"
                                        + "?#???#???????#?? 8,1,2\n"
                                        + "?#???#???? 2,2,3\n"
                                        + "?#????#.?# 2,3,1\n"
                                        + "#???..??.?##? 3,2,3\n"
                                        + "?????????##?#?#. 3,7\n"
                                        + "?????##??.? 1,4\n"
                                        + "#????.???? 2,1,1\n"
                                        + "???????#???? 1,1,2,1\n"
                                        + "??##??#??.????#??.# 7,2,2,1\n"
                                        + "#????#??#?????? 3,1,3,2\n"
                                        + "???#???.?.??. 2,1,1,1\n"
                                        + "#??#????#?##??.?.? 1,10,1\n"
                                        + "?.?.?#?.?? 1,1,1\n"
                                        + "?..##?#.?##?????.? 1,4,5,1,1\n"
                                        + "???#..????#????#??? 2,1,5,1,3\n"
                                        + "??????#.???##?#????? 1,6\n"
                                        + "????????.? 1,5\n"
                                        + "?.??????.?? 1,2,1\n"
                                        + "?????????.?#?#???#?? 3,10\n"
                                        + "??????????.????? 1,1,2,2,1\n"
                                        + "?#?#???.??.#? 2,4,1,1\n"
                                        + "??.#?.##?? 1,2,2\n"
                                        + "???.??#??#???.#?#? 1,1,1,3,4\n"
                                        + "??#??##?#???.?#??? 8,3\n"
                                        + "??##?..#????.?.? 4,1,2,1\n"
                                        + "?.??.???????.???. 2,1,1,1,3\n"
                                        + "????#?#????????# 1,2,3,1,4\n"
                                        + "??..#??.??????##.?# 2,1,1,7,1\n"
                                        + ".?????###?#?##???#? 1,8,1,1\n"
                                        + "??#?.#???.#?? 3,1,1,2\n"
                                        + "??#.???#????? 1,1,2,5\n"
                                        + "?#.????.???? 1,3,2\n"
                                        + "#???????#?.?##?? 3,3,1,5\n"
                                        + "?#????#?#?#??#?.?? 1,4,4,1\n"
                                        + "???#?#???.??? 2,3,1,2\n"
                                        + "???.##???..??? 1,2,2\n"
                                        + "#????##??.?.??.# 1,7,1,1,1\n"
                                        + "#?##????.??.???# 5,1,1,1,2\n"
                                        + "#???#???.??.#?? 1,1,3,1,1\n"
                                        + "??#??????.#??.?. 6,3\n"
                                        + ".#???.??..#?#?# 1,2,1,1,1\n"
                                        + ".???.???#??#? 1,2,1,1\n"
                                        + "??.??????#?#?#..??? 2,1,1,4,1,3\n"
                                        + "?.#?##????..?????? 1,2,2,4\n"
                                        + "#????.???.?# 1,1,1,1\n"
                                        + "?##???????##???#?? 6,9\n"
                                        + ".??????..?. 1,2,1\n"
                                        + "?..#???##?###??. 1,2,7,1\n"
                                        + "?#????##????.?#???# 2,1,2,1,1,6\n"
                                        + "??.???#??.?.? 2,5,1,1\n"
                                        + ".##?.#?#?? 3,5\n"
                                        + "?#?.??##???##??????? 1,1,4,8\n"
                                        + ".??.#????????.?# 1,4,1,1,2\n"
                                        + "??#?..####?.. 3,5\n"
                                        + "#?#?.?#?##?#.??#? 4,4,1,3\n"
                                        + "????##?#???#?.##??? 1,5,1,1,2,1\n"
                                        + "#?#????##???#??# 3,4,2,2\n"
                                        + "?.##????#..?? 7,1\n"
                                        + ".?????#.## 5,2\n"
                                        + "?#.#?????????.? 2,1,1,3,1\n"
                                        + ".???##?#?#??#??#?# 7,6\n"
                                        + "??#???#??#???#???? 6,2,5\n"
                                        + "?#?.???????#???###?? 2,3,3,4,1\n"
                                        + "???.???.??#???#??? 1,1,4,3\n"
                                        + "?##.???#?????#.#?.?? 3,2,4,1,2\n"
                                        + "#?????.?####?..?. 3,6\n"
                                        + "?#????..#??????#???? 2,2,1,9\n"
                                        + "??????#?#?? 4,5\n"
                                        + "???#?????????#???# 3,10,1\n"
                                        + "???..?#?#.. 1,3\n"
                                        + "???..?????#?###??. 2,9\n"
                                        + ".???.???.? 1,3\n"
                                        + "????#.???###.???? 1,1,3,1\n"
                                        + "?##??????#. 6,1\n"
                                        + ".#?#?#.???.?.?? 3,1,2,1\n"
                                        + ".?#?.???###?#?##?#?? 2,14\n"
                                        + "#?.???????? 2,6\n"
                                        + "??#?###?????????#??. 8,3,3\n"
                                        + "????.????.??#?. 3,2,1,1\n"
                                        + ".#?#?#?#???#??##?? 1,1,5,7\n"
                                        + ".##?#?????#?#.?.#?. 8,1,1,1,1\n"
                                        + "????..#??? 2,2\n"
                                        + "??????#????? 2,4,2\n"
                                        + "?#??#???#?...? 5,2,1\n"
                                        + "???.?.?????.? 2,5\n"
                                        + "???#?#?##??????#.?#. 10,1,1,1,2\n"
                                        + "#?..?.??#??????# 2,5,2\n"
                                        + "#?????#?#??.?# 11,1\n"
                                        + "?.#?#?.?.? 3,1\n"
                                        + "?????.?.?#???? 3,6\n"
                                        + ".??????#?#?? 1,1,2,2\n"
                                        + "#??##????#?.??????? 6,2,1,4\n"
                                        + "?.??###?.??# 1,3,3\n"
                                        + "??????#??.?#???##. 1,4,6\n"
                                        + "?????..??????#?#? 5,10\n"
                                        + "?###?#?#????#?.???.? 8,3,1\n"
                                        + "..?###??????????. 4,1,3\n"
                                        + "??????.#?#?? 1,4\n"
                                        + "???????#?.??? 1,3,2\n"
                                        + "???####???.???#.? 7,1,3,1\n"
                                        + "??#?.??.???##.??. 1,2,2,5,2\n"
                                        + "#?.???##???.?? 1,1,6,1\n"
                                        + "????#??????#?#?? 1,1,5,3\n"
                                        + ".??#.?.##?????.? 1,7,1\n"
                                        + ".?.?##??#? 3,1\n"
                                        + "?.???????#??# 1,10\n"
                                        + "?.???#??#??#??? 1,1,2,5,1\n"
                                        + "?#.???#??. 1,4\n"
                                        + "?????#?????##???? 1,5,2,1\n"
                                        + ".#?#????##? 6,2\n"
                                        + "#????#?##?..?? 1,3,3,1\n"
                                        + "?#??#?..??##?? 5,4\n"
                                        + "?.?.?#???? 1,1,1\n"
                                        + "??#???#?##?? 6,4\n"
                                        + "??.??.?????#??#?#?#? 1,1,1,5,6\n"
                                        + ".????????? 1,1,4\n"
                                        + "?#?..?#... 1,2\n"
                                        + "?#.?#?.???.???? 1,3,2,2\n"
                                        + "??#?#?#.???#??? 6,2,4\n"
                                        + "????#???##? 4,4\n"
                                        + "??.??###??#?#????#.? 11,2\n"
                                        + "??????????.??#.???? 1,5,1,1,1,2\n"
                                        + "?????????##?.? 1,2,6\n"
                                        + "?????##????#.#????? 6,3,1,1,1\n"
                                        + "?#???????#??.? 5,2,1\n"
                                        + "??#?????????. 4,1,2\n"
                                        + "#????.##????## 1,1,3,3\n"
                                        + "?#?##???##???#.?? 5,4,2,2\n"
                                        + ".#??#?#..? 6,1\n"
                                        + "#???????##???#?.??? 1,9,1,1\n"
                                        + "?.???...??? 1,1\n"
                                        + "??#??.#??#? 4,4\n"
                                        + "??.#???#.?#????? 1,3,1,1,1\n"
                                        + "?#?.#?#.#?.?###???## 2,3,1,9\n"
                                        + "??#?#????#??#? 7,2,2\n"
                                        + "#??#?.?#?.??? 1,1,2,2\n"
                                        + "..#.?.?#??.? 1,2\n"
                                        + "????#?????#?#??? 1,1,1,6,1\n"
                                        + "?.???##???????##?.?. 6,2\n"
                                        + ".##.??????#? 2,7\n"
                                        + "?.#?....?#? 2,2\n"
                                        + "??????..?#####????? 1,3,8\n"
                                        + "?.?????#???? 1,3\n"
                                        + "??#???????? 1,1,3\n"
                                        + ".???#?????.#?. 1,4,2\n"
                                        + "?.??.#??#?#??? 1,8\n"
                                        + "???????????????? 1,4,1,1,1\n"
                                        + "???##?#????# 1,5,3\n"
                                        + "??#??.???##? 1,1,1,5\n"
                                        + ".##??#?.?????.???#? 5,2,1,1,1\n"
                                        + "..?##.???????.?#?. 3,3,1,3\n"
                                        + "#??#???.???#..?? 4,1,3,1\n"
                                        + "??#????????.? 3,1,1\n"
                                        + "??.??#???#??#?????.# 1,4,5,2,1\n"
                                        + "?#?..????#??? 2,1,1,3\n"
                                        + "?????...#.? 1,1,1\n"
                                        + "??.?.??###?.?? 1,4,1\n"
                                        + "??..?.#????#????#.?? 2,6\n"
                                        + ".???#?????#. 7,1\n"
                                        + "??????#?#?.#.??.??? 9,1,2,2";

    public static void main(String[] args) {
        Util.time(() -> a(Input.parse(TEST_INPUT)));
        Util.time(() -> a(Input.parse(INPUT)));
        Util.time(() -> b(Input.parse(TEST_INPUT)));
        Util.time(() -> b(Input.parse(INPUT)));
    }
}
